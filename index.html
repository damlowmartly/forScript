<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notes & Scripts</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f4f4f4;
    padding-bottom: 100px;
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 15px;
    padding: 20px;
}

.card {
    background: white;
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    min-height: 120px;
    font-weight: bold;
}

.btn-bar {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
}

button {
    padding: 12px 22px;
    border-radius: 30px;
    border: none;
    background: #333;
    color: white;
    cursor: pointer;
}

.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10;
}

.panel {
    width: 90vw;
    height: 90vh;
    background: white;
    border-radius: 12px;
    padding: 20px;
    overflow: auto;
    position: relative;
}

.close {
    position: absolute;
    top: 12px;
    right: 15px;
    cursor: pointer;
    font-size: 20px;
}

input, textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    font-size: 14px;
}

.result {
    background: #f1f1f1;
    padding: 15px;
    border-radius: 8px;
    white-space: pre-wrap;
    margin-top: 10px;
}

.script-inputs input {
    margin-bottom: 6px;
}
</style>
</head>
<body>

<div class="grid" id="grid"></div>

<div class="btn-bar">
    <button onclick="openNote()">Create</button>
    <button onclick="openScript()">CreateScript</button>
</div>

<!-- CREATE NOTE -->
<div class="modal" id="noteModal">
    <div class="panel">
        <span class="close" onclick="closeAll()">✕</span>
        <input id="noteTitle" placeholder="Note title">
        <textarea id="noteText" rows="6" placeholder="Write your note"></textarea>
        <button onclick="saveNote()">Save</button>
    </div>
</div>

<!-- CREATE SCRIPT -->
<div class="modal" id="scriptModal">
    <div class="panel">
        <span class="close" onclick="closeAll()">✕</span>
        <input id="scriptTitle" placeholder="Script title">
        <textarea id="scriptText" rows="8" placeholder="Use placeholders like 1& 2& 3&"></textarea>
        <button onclick="saveScript()">Save Script</button>
    </div>
</div>

<!-- VIEW SCRIPT -->
<div class="modal" id="viewScriptModal">
    <div class="panel">
        <span class="close" onclick="closeAll()">✕</span>
        <div class="script-inputs" id="scriptInputs"></div>
        <div class="result" id="scriptResult"></div>
    </div>
</div>

<script>
const grid = document.getElementById("grid");
let items = JSON.parse(localStorage.getItem("items")) || [];

/* ---------- RENDER ---------- */
function render() {
    grid.innerHTML = "";
    items.forEach((item, i) => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerText = item.title;
        div.onclick = () => {
            if (item.type === "script") openScriptView(i);
            else alert(item.text);
        };
        grid.appendChild(div);
    });
}
render();

/* ---------- MODALS ---------- */
function openNote() {
    noteModal.style.display = "flex";
}

function openScript() {
    scriptModal.style.display = "flex";
}

function closeAll() {
    document.querySelectorAll(".modal").forEach(m => m.style.display = "none");
}

/* ---------- SAVE ---------- */
function saveNote() {
    if (!noteTitle.value || !noteText.value) return;
    items.push({
        type: "note",
        title: noteTitle.value,
        text: noteText.value
    });
    localStorage.setItem("items", JSON.stringify(items));
    closeAll();
    render();
}

function saveScript() {
    if (!scriptTitle.value || !scriptText.value) return;
    items.push({
        type: "script",
        title: scriptTitle.value,
        template: scriptText.value
    });
    localStorage.setItem("items", JSON.stringify(items));
    closeAll();
    render();
}

/* ---------- SCRIPT ENGINE ---------- */
function openScriptView(index) {
    const script = items[index];
    const inputsDiv = document.getElementById("scriptInputs");
    const resultDiv = document.getElementById("scriptResult");

    inputsDiv.innerHTML = "";
    resultDiv.innerText = script.template;

    // Detect placeholders 1& to 10&
    const matches = [...script.template.matchAll(/\b([1-9]|10)&/g)]
        .map(m => m[1])
        .filter((v, i, a) => a.indexOf(v) === i);

    const values = {};

    matches.forEach(n => {
        const input = document.createElement("input");
        input.placeholder = `Value for ${n}&`;
        input.oninput = () => {
            values[n] = input.value;
            let output = script.template;
            Object.keys(values).forEach(k => {
                output = output.replaceAll(`${k}&`, values[k]);
            });
            resultDiv.innerText = output;
        };
        inputsDiv.appendChild(input);
    });

    viewScriptModal.style.display = "flex";
}
</script>

</body>
</html>
