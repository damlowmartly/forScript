<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notes & Scripts</title>
<style>
.modal-content {
    background: white;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    height: 90vh;      /* modal height */
    display: flex;
    gap: 10px;
}

/* LEFT SIDE OF MODAL (notes + inputs) */
.modal-left {
    width: 20%;
    display: flex;
    flex-direction: column;
    gap: 10px;
    height: 100%;      /* full height of modal */
    overflow-y: auto;  /* allow scrolling if note content is long */
}

/* RIGHT SIDE OF MODAL (image) */
.modal-right {
    width: 80%;
    height: 100%;      /* full height of modal */
    display: flex;
    justify-content: center;
    align-items: center;
    background: #f0f0f0;
    border-radius: 8px;
}

.modal-right img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* show full image */
    display: block;
}

</style>
</head>
<body>

<div class="grid" id="grid"></div>

<button class="create-btn" onclick="openCreateNote()">Create Note</button>
<button class="create-btn" style="left:65%" onclick="openCreateScript()">Create Script</button>

<!-- Create Note Modal -->
<div class="modal" id="createNoteModal">
    <div class="modal-content">
        <div class="modal-left">
            <input type="text" id="noteTitleInput" placeholder="Title">
            <textarea id="noteContentInput" placeholder="Notes"></textarea>
            <input type="file" id="noteImageInput" accept="image/*">
            <button class="save-btn" onclick="saveNote()">Save</button>
        </div>
        <div class="modal-right">
            <img id="notePreview">
        </div>
    </div>
</div>

<!-- View Note Modal -->
<div class="modal" id="viewNoteModal">
    <button class="close-btn" onclick="closeAll()">✕</button>
    <div class="view-panel">
        <div class="view-notes">
            <div class="view-title" id="viewNoteTitle"></div>
            <div class="notes-text" id="viewNoteContent"></div>
        </div>
        <div class="view-image">
            <img id="viewNoteImage">
        </div>
    </div>
</div>

<!-- Create Script Modal -->
<div class="modal" id="createScriptModal">
    <div class="modal-content" style="flex-direction:column;">
        <input type="text" id="scriptTitleInput" placeholder="Script title">
        <textarea id="scriptContentInput" rows="6" placeholder="Use placeholders like 1& 2&"></textarea>
        <div id="dynamicScriptInputs" style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;"></div>
        <div id="scriptLiveResult" style="background:#f1f1f1; padding:10px; border-radius:8px; margin-top:10px; flex:1; white-space:pre-wrap;"></div>
        <button class="save-btn" onclick="saveScript()">Save Script</button>
    </div>
</div>

<!-- View Script Modal -->
<div class="modal" id="viewScriptModal">
    <button class="close-btn" onclick="closeAll()">✕</button>
    <div class="script-panel">
        <div class="script-inputs" id="scriptInputs"></div>
        <button class="save-btn" onclick="saveScriptValues()">Save Values</button>
        <div class="result" id="scriptResult"></div>
    </div>
</div>

<script>
const grid = document.getElementById("grid");
let notes = JSON.parse(localStorage.getItem("notes"))||[];
let scripts = JSON.parse(localStorage.getItem("scripts"))||[];
let activeScriptIndex = null;

// RENDER GRID
function renderGrid() {
    grid.innerHTML = "";
    notes.forEach((note,i)=>{
        const div = document.createElement("div");
        div.className="note";
        div.innerText=note.title;
        const del=document.createElement("button");
        del.className="delete-btn";
        del.innerText="✕";
        del.onclick=e=>{e.stopPropagation();notes.splice(i,1);localStorage.setItem("notes",JSON.stringify(notes));renderGrid();}
        div.appendChild(del);
        div.onclick=()=>openViewNote(i);
        grid.appendChild(div);
    });
    scripts.forEach((script,i)=>{
        const div=document.createElement("div");
        div.className="script";
        div.innerText=script.title;
        const del=document.createElement("button");
        del.className="delete-btn";
        del.innerText="✕";
        del.onclick=e=>{e.stopPropagation();scripts.splice(i,1);localStorage.setItem("scripts",JSON.stringify(scripts));renderGrid();}
        div.appendChild(del);
        div.onclick=()=>openViewScript(i);
        grid.appendChild(div);
    });
}
renderGrid();

// OPEN/CLOSE MODALS
function openCreateNote(){document.getElementById("createNoteModal").style.display="flex";}
function openCreateScript(){document.getElementById("createScriptModal").style.display="flex";}
function closeAll(){document.querySelectorAll(".modal").forEach(m=>m.style.display="none");}

// SAVE NOTE
function saveNote(){
    const title = document.getElementById("noteTitleInput").value.trim();
    const content = document.getElementById("noteContentInput").value.trim();
    const imageInput=document.getElementById("noteImageInput");
    if(!title || !content) return;

    if(imageInput.files[0]){
        const reader=new FileReader();
        reader.onload=()=>{pushNote(reader.result);}
        reader.readAsDataURL(imageInput.files[0]);
    }else pushNote(null);

    function pushNote(img){
        notes.push({title,content,image:img});
        localStorage.setItem("notes",JSON.stringify(notes));
        document.getElementById("noteTitleInput").value="";
        document.getElementById("noteContentInput").value="";
        document.getElementById("noteImageInput").value="";
        document.getElementById("notePreview").src="";
        closeAll(); renderGrid();
    }
}

// IMAGE PREVIEW
document.getElementById("noteImageInput").addEventListener("change", function(){
    const file = this.files[0];
    if(file){
        const reader = new FileReader();
        reader.onload = e => { document.getElementById("notePreview").src = e.target.result; }
        reader.readAsDataURL(file);
    }
});

// VIEW NOTE
function openViewNote(index){
    const note = notes[index];
    document.getElementById("viewNoteTitle").innerText=note.title;
    document.getElementById("viewNoteContent").innerText=note.content;
    document.getElementById("viewNoteImage").src=note.image||"";
    document.getElementById("viewNoteModal").style.display="flex";
}

// SCRIPT DYNAMIC LOGIC
const scriptContentInput = document.getElementById("scriptContentInput");
const dynamicInputsDiv = document.getElementById("dynamicScriptInputs");
const scriptLiveResult = document.getElementById("scriptLiveResult");
let currentScriptValues = {};

function updateLiveScript(template, values) {
    let out = template;
    Object.keys(values).forEach(k=>{ out = out.replaceAll(`${k}&`, values[k]); });
    scriptLiveResult.innerText = out;
}

function generateDynamicInputs(template, savedValues={}) {
    dynamicInputsDiv.innerHTML = "";
    currentScriptValues = {...savedValues};

    const matches = [...template.matchAll(/\b([1-9]|10)&/g)]
        .map(m=>m[1])
        .filter((v,i,a)=>a.indexOf(v)===i);

    matches.forEach(n=>{
        const input = document.createElement("input");
        input.placeholder = `${n}&`;
        input.style.padding = "10px";
        input.style.fontSize = "16px";
        input.value = currentScriptValues[n] || "";
        input.oninput = ()=>{currentScriptValues[n] = input.value; updateLiveScript(template,currentScriptValues);}
        dynamicInputsDiv.appendChild(input);
    });
    updateLiveScript(template, currentScriptValues);
}

scriptContentInput.addEventListener("input", ()=>{
    generateDynamicInputs(scriptContentInput.value);
});

// SAVE SCRIPT
function saveScript(){
    const title = document.getElementById("scriptTitleInput").value.trim();
    const template = scriptContentInput.value.trim();
    if(!title || !template) return;
    scripts.push({
        title,
        template,
        values: {...currentScriptValues}
    });
    localStorage.setItem("scripts",JSON.stringify(scripts));
    document.getElementById("scriptTitleInput").value="";
    scriptContentInput.value="";
    dynamicInputsDiv.innerHTML="";
    scriptLiveResult.innerText="";
    closeAll();
    renderGrid();
}

// VIEW SCRIPT
function openViewScript(index){
    activeScriptIndex = index;
    const script = scripts[index];
    const inputsDiv = document.getElementById("scriptInputs");
    const resultDiv = document.getElementById("scriptResult");
    inputsDiv.innerHTML="";
    const values = script.values || {};
    const matches = [...script.template.matchAll(/\b([1-9]|10)&/g)]
        .map(m=>m[1])
        .filter((v,i,a)=>a.indexOf(v)===i);
    matches.forEach(n=>{
        const input = document.createElement("input");
        input.placeholder = `${n}&`;
        input.value = values[n] || "";
        input.oninput = ()=>{values[n] = input.value; updateScriptResult(script.template, values);}
        inputsDiv.appendChild(input);
    });
    updateScriptResult(script.template, values);
    document.getElementById("viewScriptModal").style.display="flex";
}

function updateScriptResult(template, values){
    let out = template;
    Object.keys(values).forEach(k=>{ out = out.replaceAll(`${k}&`, values[k]); });
    document.getElementById("scriptResult").innerText = out;
}

function saveScriptValues(){
    if(activeScriptIndex===null) return;
    const script = scripts[activeScriptIndex];
    const inputs = document.querySelectorAll("#scriptInputs input");
    const values = {};
    inputs.forEach(input=>{ const k = input.placeholder.match(/\d+/)[0]; values[k] = input.value; });
    script.values = values;
    localStorage.setItem("scripts",JSON.stringify(scripts));
    alert("Values saved!");
}

// CLOSE MODAL ON CLICK OUTSIDE
window.onclick = e=>{ if(e.target.classList.contains("modal")) closeAll(); }
</script>
</body>
</html>
