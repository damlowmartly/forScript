<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notes & Scripts</title>
<style>
body {margin:0;font-family:Arial,sans-serif;background:#f4f4f4;padding-bottom:80px;}
.grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:15px;padding:20px;}
.note, .script {background:white;border-radius:10px;padding:15px;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,0.1);display:flex;align-items:center;justify-content:center;text-align:center;min-height:120px;font-weight:bold;transition: transform 0.2s;position:relative;}
.note:hover, .script:hover {transform:scale(1.03);}
.delete-btn{position:absolute;top:6px;right:8px;background:#ff4d4d;color:white;border:none;border-radius:50%;width:22px;height:22px;font-size:14px;cursor:pointer;line-height:20px;}
.create-btn {position:fixed;bottom:20px;left:50%;transform:translateX(-50%);padding:15px 30px;font-size:16px;border:none;border-radius:30px;background:#333;color:white;cursor:pointer;}
.modal {position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:10;}
.modal-content {background:white;padding:20px;border-radius:10px;width:320px;display:flex;flex-direction:column;gap:10px;}
input,textarea {padding:10px;font-size:14px;width:100%;}
.save-btn {background:#333;color:white;border:none;padding:10px;cursor:pointer;border-radius:5px;}
.close-btn {position:absolute;top:15px;right:15px;background:rgba(0,0,0,0.6);color:white;border:none;padding:8px 12px;cursor:pointer;border-radius:20px;z-index:20;}
.view-panel {background:white;width:90%;max-width:1000px;height:80vh;border-radius:12px;overflow:hidden;display:grid;grid-template-columns:1fr 1.4fr;}
.view-notes {padding:25px;overflow-y:auto;}
.view-title {font-size:22px;font-weight:bold;margin-bottom:15px;}
.notes-text {white-space:pre-wrap;line-height:1.6;}
.view-image {background:#000;}
.view-image img {width:100%;height:100%;background-size:cover;}
.script-panel {background:white;width:90%;max-width:600px;height:80vh;border-radius:12px;padding:20px;display:flex;flex-direction:column;}
.script-inputs input{margin-bottom:6px;width:100%;}
.result{background:#f1f1f1;padding:15px;border-radius:8px;white-space:pre-wrap;margin-top:10px;flex:1;}
</style>
</head>
<body>

<div class="grid" id="grid"></div>

<button class="create-btn" onclick="openCreateNote()">Create</button>
<button class="create-btn" style="left:65%" onclick="openCreateScript()">CreateScript</button>

<!-- Create Note Modal -->
<div class="modal" id="createNoteModal">
    <div class="modal-content">
        <input type="text" id="noteTitleInput" placeholder="Title">
        <textarea id="noteContentInput" rows="5" placeholder="Notes"></textarea>
        <input type="file" id="noteImageInput" accept="image/*">
        <button class="save-btn" onclick="saveNote()">Save</button>
    </div>
</div>

<!-- View Note Modal -->
<div class="modal" id="viewNoteModal">
    <button class="close-btn" onclick="closeAll()">✕</button>
    <div class="view-panel">
        <div class="view-notes">
            <div class="view-title" id="viewNoteTitle"></div>
            <div class="notes-text" id="viewNoteContent"></div>
        </div>
        <div class="view-image">
            <img id="viewNoteImage">
        </div>
    </div>
</div>

<!-- Create Script Modal -->
<div class="modal" id="createScriptModal">
    <div class="modal-content">
        <input type="text" id="scriptTitleInput" placeholder="Script title">
        <textarea id="scriptContentInput" rows="6" placeholder="Use placeholders like 1& 2&"></textarea>
        <button class="save-btn" onclick="saveScript()">Save Script</button>
    </div>
</div>

<!-- View Script Modal -->
<div class="modal" id="viewScriptModal">
    <button class="close-btn" onclick="closeAll()">✕</button>
    <div class="script-panel">
        <div class="script-inputs" id="scriptInputs"></div>
        <button class="save-btn" onclick="saveScriptValues()">Save Values</button>
        <div class="result" id="scriptResult"></div>
    </div>
</div>

<script>
const grid = document.getElementById("grid");

let notes = JSON.parse(localStorage.getItem("notes"))||[];
let scripts = JSON.parse(localStorage.getItem("scripts"))||[];
let activeScriptIndex = null;

// RENDER GRID
function renderGrid() {
    grid.innerHTML = "";
    notes.forEach((note,i)=>{
        const div = document.createElement("div");
        div.className="note";
        div.innerText=note.title;
        const del=document.createElement("button");
        del.className="delete-btn";
        del.innerText="✕";
        del.onclick=e=>{e.stopPropagation();notes.splice(i,1);localStorage.setItem("notes",JSON.stringify(notes));renderGrid();}
        div.appendChild(del);
        div.onclick=()=>openViewNote(i);
        grid.appendChild(div);
    });
    scripts.forEach((script,i)=>{
        const div=document.createElement("div");
        div.className="script";
        div.innerText=script.title;
        const del=document.createElement("button");
        del.className="delete-btn";
        del.innerText="✕";
        del.onclick=e=>{e.stopPropagation();scripts.splice(i,1);localStorage.setItem("scripts",JSON.stringify(scripts));renderGrid();}
        div.appendChild(del);
        div.onclick=()=>openViewScript(i);
        grid.appendChild(div);
    });
}
renderGrid();

// OPEN/CLOSE MODALS
function openCreateNote(){document.getElementById("createNoteModal").style.display="flex";}
function openCreateScript(){document.getElementById("createScriptModal").style.display="flex";}
function closeAll(){document.querySelectorAll(".modal").forEach(m=>m.style.display="none");}

// SAVE NOTE
function saveNote(){
    const title = document.getElementById("noteTitleInput").value.trim();
    const content = document.getElementById("noteContentInput").value.trim();
    const imageInput=document.getElementById("noteImageInput");
    if(!title || !content) return;

    if(imageInput.files[0]){
        const reader=new FileReader();
        reader.onload=()=>{pushNote(reader.result);}
        reader.readAsDataURL(imageInput.files[0]);
    }else pushNote(null);

    function pushNote(img){
        notes.push({title,content,image:img});
        localStorage.setItem("notes",JSON.stringify(notes));
        document.getElementById("noteTitleInput").value="";
        document.getElementById("noteContentInput").value="";
        document.getElementById("noteImageInput").value="";
        closeAll(); renderGrid();
    }
}

// VIEW NOTE
function openViewNote(index){
    const note = notes[index];
    document.getElementById("viewNoteTitle").innerText=note.title;
    document.getElementById("viewNoteContent").innerText=note.content;
    document.getElementById("viewNoteImage").src=note.image||"";
    document.getElementById("viewNoteModal").style.display="flex";
}

// SAVE SCRIPT
function saveScript(){
    const title=document.getElementById("scriptTitleInput").value.trim();
    const content=document.getElementById("scriptContentInput").value.trim();
    if(!title || !content) return;
    scripts.push({title,template:content,values:{}});
    localStorage.setItem("scripts",JSON.stringify(scripts));
    document.getElementById("scriptTitleInput").value="";
    document.getElementById("scriptContentInput").value="";
    closeAll();renderGrid();
}

// VIEW SCRIPT
function openViewScript(index){
    activeScriptIndex=index;
    const script=scripts[index];
    const inputsDiv=document.getElementById("scriptInputs");
    const resultDiv=document.getElementById("scriptResult");
    inputsDiv.innerHTML="";
    let values=script.values||{};
    const matches=[...script.template.matchAll(/\b([1-9]|10)&/g)].map(m=>m[1]).filter((v,i,a)=>a.indexOf(v)===i);
    matches.forEach(n=>{
        const input=document.createElement("input");
        input.placeholder=`Value for ${n}&`;
        input.value=values[n]||"";
        input.oninput=()=>{values[n]=input.value;updateScriptResult(script.template,values);}
        inputsDiv.appendChild(input);
    });
    updateScriptResult(script.template,values);
    document.getElementById("viewScriptModal").style.display="flex";
}

// UPDATE SCRIPT RESULT
function updateScriptResult(template,values){
    let out=template;
    Object.keys(values).forEach(k=>{out=out.replaceAll(`${k}&`,values[k]);});
    document.getElementById("scriptResult").innerText=out;
}

// SAVE SCRIPT VALUES
function saveScriptValues(){
    if(activeScriptIndex===null) return;
    const script=scripts[activeScriptIndex];
    const inputs=document.querySelectorAll("#scriptInputs input");
    const values={};
    inputs.forEach(input=>{const k=input.placeholder.match(/\d+/)[0];values[k]=input.value;});
    script.values=values;
    localStorage.setItem("scripts",JSON.stringify(scripts));
    alert("Values saved!");
}

// CLOSE MODAL BY CLICK OUTSIDE
window.onclick=e=>{
    if(e.target.classList.contains("modal")) closeAll();
}
</script>

</body>
</html>
